id: 9221
date: 2013-02-11 12:39:42 -0500
author: William
parent: angle-constraint
avatar: http://0.gravatar.com/avatar/9abfec71f4798ded76d242c8df48067e?s=96&d=mm&r=g
message: "<p>Just to give a few more details (I'm not sure if I answered your question fully).  The typical flow is:<br />\n  1. Apply external forces/torques to get new velocities.<br />\n  2. Initialize constraints (compute the K matrices).<br />\n  3. Solve velocity constraints using the K matrix.  Using an iterative approach this will be called a number of times to reach a global solution, but since the K matrix is dependent on position and mass rather than velocity, it doesn't need to be recomputed.<br />\n  4. Apply the velocities to get new positions<br />\n  5. Solve position constraints (position correction).  If you are going for the iterative approach, you need to be careful here.  To do this right you will need to recompute the K matrix on each call since the K matrix is dependent on the position and the position is changing at the end of each call. (In some cases, like the angle joint, this isn't the case since K only includes the mass).  Since this is a heavy process, you can probably get away with using the same K matrix without much loss in accuracy in most cases.</p>\n<p>Then repeat.  Applying the position correction will be seen in the computation of the K matrix and that's how it gets fed back into the velocity constraint upon the next iteration.</p>\n<p>Hope that helps,<br />\nWilliam</p>"