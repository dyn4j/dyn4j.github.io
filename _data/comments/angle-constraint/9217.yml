id: 9217
date: 2013-01-02 13:25:26 -0500
author: William
parent: angle-constraint
avatar: http://0.gravatar.com/avatar/9abfec71f4798ded76d242c8df48067e?s=96&d=mm&r=g
message: "<p>Just to clarify, are you having trouble with the limits or just constraining the 5 DOF.  I would try the joint without limits and see if you can get it to work without it locking, then add in the limits.  Limits, especially rotational limits are annoying to get right (at least in my <em>limited</em> experience).</p>\n<p>What you describe here seems to be correct. When you do the transformation of world to local coordinates you should be including the body rotation too.  Also, on each iteration be sure to transform the local vectors and anchors properly.  I had a few problems with this myself and it ended up being a problem in my local<=>world transformation code.</p>\n<p>// assume that a body contains an augmented<br />\n// transformation matrix<br />\nT = [ R<sub>0,0</sub> R<sub>0,1</sub> R<sub>0,2</sub> | x ]<br />\n    [ R<sub>1,0</sub> R<sub>1,1</sub> R<sub>1,2</sub> | y ]<br />\n    [ R<sub>2,0</sub> R<sub>2,1</sub> R<sub>2,2</sub> | z ]<br />\n// to transform from local coordinates to world<br />\n// you simply multiply the matrix with the<br />\n// vector/point that you want to transform<br />\nlocalV = [ x ]<br />\n         [ y ]<br />\n         [ z ]<br />\n         [ 1 ]<br />\nworldV = T * localV<br />\n// then to transform back you need to invert<br />\n// the transformation matrix to do this, it's<br />\n// best not to use the augmented matrix since a<br />\n// <a onclick=\"javascript:pageTracker._trackPageview('/outgoing/en.wikipedia.org/wiki/Rotation_matrix');\"  href=\"http://en.wikipedia.org/wiki/Rotation_matrix\" title=\"Rotation Matrix\" target=\"_blank\" rel=\"nofollow\">rotation matrix</a> can be easily inverted<br />\n// by taking the transpose:<br />\nR<sup>-1</sup> = R<sup>T</sup><br />\nT<sub>x,y,z</sub><sup>T</sup> = [ x y z ]<br />\nlocalV = R<sup>-1</sup> * (worldV &#8211; T<sub>x,y,z</sub>)</p>\n<p>You may also want to consider looking at using Quaternions rather than using Euler angles since they can solve some <a onclick=\"javascript:pageTracker._trackPageview('/outgoing/en.wikipedia.org/wiki/Gimbal_lock');\"  href=\"http://en.wikipedia.org/wiki/Gimbal_lock\" title=\"Gimbal Lock\" target=\"_blank\" rel=\"nofollow\">gimbal lock</a> problems (they may come with their own problems too though).</p>\n<p>I think you only need the hinge axis in one body's coordinates since it can only be fixed in one coordinate frame.</p>\n<p>William</p>"