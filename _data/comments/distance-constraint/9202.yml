id: 9202
date: 2012-07-25 13:00:28 -0400
author: William
parent: distance-constraint
avatar: http://0.gravatar.com/avatar/9abfec71f4798ded76d242c8df48067e?s=96&d=mm&r=g
message: "<p>Exactly.  In the <a href=\"http://www.dyn4j.org/2010/07/equality-constraints/\" title=\"Equality Constraints\" rel=\"nofollow\">Equality Constraints</a> post I briefly touch on the drift problem.  Basically as you pointed out, the velocity constraints can easily be satisfied, however, because our integration techniques are approximations, we will always get drift in the position constraints.  The generally accepted solution to this problem is to use some sort of post stabilization method.</p>\n<p>Unfortunately I don't have a post for this yet but I can offer a few details.  If we take our original position constraint that we defined:</p>\n<p><img src=\"http://www.dyn4j.org/wp-content/uploads/2010/07/dc-23.png\" alt=\"Distance Constraint - Position Constraint\" /></p>\n<p>and we solve this for C we get the position constraint error.  We can feed this error back into the velocity constraint by moving/rotating the bodies by this error (using the effective mass to apply the position correction appropriately):</p>\n<p><img src=\"http://www.dyn4j.org/wp-content/uploads/2010/07/distance_6_1.png\" alt=\"Solve the position constriant for C\" /></p>\n<p>Then we can apply this position correction by:</p>\n<p><img src=\"http://www.dyn4j.org/wp-content/uploads/2010/07/distance_6_2.png\" alt=\"Solve for the change in position and rotation\" /></p>\n<p>This will give the change in position of the Center of Mass and the change in Rotation of both bodies.  Because we changed the position and rotation, upon the next iteration of the simulation, the velocity constraint will see these changes (that's why we say \"the position error gets feed back into the velocity constraint\").</p>\n<p>Naturally, each constraint will have a different position constraint equation.  The one above is specifically for the Distance Constraint.  But they all follow the same process, solve the position constraint for C (which could be a vector instead of a scalar for some constraints) and then scale this by the \"effective mass\" (the K matrix).  Then apply the result to the bodies.</p>\n<p>William</p>"